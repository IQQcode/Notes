### æ•°æ®å…±äº«å¸¦æ¥çš„å¹¶å‘é—®é¢˜

> å¤šçº¿ç¨‹æœ‰ä¸¤ä¸ªç»å…¸æ¡ˆä¾‹ï¼Œ12306ä¹°ç¥¨é—®é¢˜å’Œä¸Šå•æ‰€é—®é¢˜ğŸ˜‚

**ä¸€ä»½èµ„æºï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«ï¼Œä¼šå¸¦æ¥å¹¶å‘é—®é¢˜(æ•°æ®çš„ä¸ä¸€è‡´æ€§)**

åœ¨å®ä¾‹åŒ–Web12306çš„æ—¶å€™ï¼Œè¦æƒ³è¾¾åˆ°20å¼ ç¥¨ï¼Œ3ä¸ªé»„ç‰›åŒæ—¶åœ¨å–ï¼Œå°±åªèƒ½å®ä¾‹åŒ–ä¸€æ¬¡ï¼›

- å¦‚æœå®ä¾‹åŒ–ä¸‰æ¬¡ï¼Œåˆ™æˆä¸ºæ¯ä¸ªé»„ç‰›åœ¨å–20å¼ ç¥¨ï¼Œä¸ä¼šäº§ç”Ÿå¹¶å‘é—®é¢˜ï¼Œå› ä¸ºæ­¤æ—¶æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½å¾—å¸¦åˆ°äº†ä¸€ä»½èµ„æº

ä¸ºäº†æ¨¡æ‹Ÿä¹°ç¥¨æ—¶çš„ç½‘ç»œå»¶è¿Ÿï¼ŒSleep 200ms
![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pcXFjb2RlLWJsb2cub3NzLWNuLWJlaWppbmcuYWxpeXVuY3MuY29tL2ltZy8yMDIwMDUyNjEwMDExOS5wbmc?x-oss-process=image/format,png)
ä½†å¾—çš„ç»“æœå´æ˜¯ï¼šã€ä¸å­˜åœ¨çš„ç¥¨ã€‘
 <img src="https://img-blog.csdnimg.cn/20190721211154327.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzIzMjk1NQ==,size_16,color_FFFFFF,t_70" width="60%">

20ä»½ç¥¨çš„èµ„æºç»™3ä¸ªé»„ç‰›æ¥å–ï¼Œç¥¨æ˜¾ç„¶ä¸ä¼šå‡ºç°è´Ÿæ•°ï¼Œè¿™å°±æ˜¯å¹¶å‘å¸¦æ¥çš„æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜

**å…·ä½“çš„åŸå› ï¼š**

é¦–å…ˆæˆ‘ä»¬è¦æ˜ç™½çš„ä¸€ç‚¹å°±æ˜¯ï¼ŒCPUæ‰§è¡Œçš„é€Ÿåº¦éå¸¸çš„å¿«ï¼Œç”¨msç”šè‡³æ˜¯nsæ¥è¡¡é‡
 <img src="https://img-blog.csdnimg.cn/20190721211754240.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzIzMjk1NQ==,size_16,color_FFFFFF,t_70" width="100%">

å½“åªå‰©æœ€åä¸€å¼ ç¥¨æ—¶ï¼Œå‡è®¾çº¿ç¨‹1ã€çº¿ç¨‹2ã€çº¿ç¨‹3åˆ†åˆ«è¢«CPUè°ƒåº¦ï¼š

1. tickets = 1 > 0ï¼Œçº¿ç¨‹1å…ˆè¿›å…¥åˆ°whileå¾ªç¯ä¸­ï¼Œä¼‘çœ 200msï¼Œäº¤å‡ºäº†CPUæ‰§è¡Œæƒï¼›
2. æ­¤æ—¶ï¼ŒCPUç©ºé—²ï¼Œè°ƒåº¦çº¿ç¨‹2ï¼Œç”±äºçº¿ç¨‹1åœ¨ä¼‘çœ ä¸­è¿˜æ²¡æœ‰å–å‡ºç¥¨ï¼Œæ­¤æ—¶ tickets = 1ï¼›
3. çº¿ç¨‹2è¿›å…¥whileå¾ªç¯ï¼Œä¹Ÿä¼‘çœ 200msã€‚æ­¤æ—¶ticketsä»ç„¶ç­‰äº1ï¼›
4. ç”±äºCPUåˆ‡æ¢çš„é€Ÿåº¦éå¸¸å¿«ï¼Œæ­¤æ—¶çº¿ç¨‹1å’Œçº¿ç¨‹2ä»ç„¶åœ¨ä¼‘çœ ä¸­ï¼ŒCPUè°ƒåº¦çº¿ç¨‹3ï¼›
5. çº¿ç¨‹3è¿›å…¥whileå¾ªç¯ï¼ŒåŒæ ·ä¼‘çœ 200ms
6. çº¿ç¨‹1æœ€å…ˆä¼‘çœ ï¼Œæ‰€ä»¥æœ€å…ˆé†’æ¥ã€‚æ‰§è¡Œ`tickets--`æ“ä½œï¼Œ`tickets = 0`ï¼Œæ­¤æ—¶çº¿ç¨‹2å’Œçº¿ç¨‹3ä»åœ¨ä¼‘çœ ä¸­
7. çº¿ç¨‹2ç¡çœ å®Œæˆï¼Œç”±äºçº¿ç¨‹2å’Œçº¿ç¨‹3æ­¤æ—¶å·²ç»è¿›å…¥åˆ°äº†å¾ªç¯ä¸­ï¼Œæ‰€ä»¥å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚çº¿ç¨‹2æ‰§è¡Œ`tickets--`æ“ä½œï¼Œ`tickets = -1`ï¼›
8. åŒç†ï¼Œçº¿ç¨‹ä¸‰é†’æ¥ååˆæ‰§è¡Œ`tickets--`ï¼Œ`tickets = -2`

---------------

è¿˜æœ‰å¯èƒ½å¾—åˆ°çš„ç»“æœæ˜¯ï¼šã€å–é‡å¤çš„ç¥¨ã€‘

<img src = "https://img-blog.csdnimg.cn/20190724162432913.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzIzMjk1NQ==,size_16,color_FFFFFF,t_70" width="70%"> 

åŒä¸€ä»½èµ„æºï¼Œè¢«ä¸‰ä¸ªçº¿ç¨‹åŒæ—¶æ‹¿åˆ°

<img src = "https://img-blog.csdnimg.cn/20190724175825731.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzIzMjk1NQ==,size_16,color_FFFFFF,t_70" width = "70%">

æ¯ä¸ªçº¿ç¨‹åœ¨å·¥ä½œçš„æ—¶å€™ï¼Œéƒ½ä¼šåœ¨ç›¸åº”çš„æ ˆä¸­æ‰§è¡Œï¼Œä¸€ä¸ªçº¿ç¨‹å¼€è¾Ÿä¸€ä¸ªæ ˆç©ºé—´ï¼ˆå¿˜äº†çš„ä¼™ä¼´çœ‹çœ‹ä¸Šé¢çº¿ç¨‹æ‰§è¡Œçš„å†…å­˜å›¾ï¼‰ï¼Œå®ƒä»¬ä»å†…å­˜ä¸­è¯»å–æ•°æ®ã€‚

æ¯”å¦‚åœ¨å–ç¬¬10å¼ ç¥¨æ—¶ï¼ŒAçº¿ç¨‹ä»ä¸»å­˜ä¸­æ‹¿åˆ°äº†10ï¼›ç”±äºCPUçš„æ“ä½œéå¸¸çš„å—ï¼Œåœ¨AæŠŠ10æ‹¿åˆ°ä»–çš„å·¥ä½œåŒºé—´çš„æ—¶å€™ï¼Œçº¿ç¨‹Bå’Œçº¿ç¨‹Cä¹ŸåŒæ—¶ä»ä¸»å­˜ä¸­æ‹¿åˆ°äº†å„è‡ªçš„å·¥ä½œåŒºé—´ï¼›æ‰€ä»¥å°±å¯¼è‡´ç¬¬10å¼ ç¥¨è¢«å–äº†3æ¬¡...

-----------

**æ³¨æ„ï¼š**

çº¿ç¨‹å®‰å…¨é—®é¢˜æ˜¯ä¸èƒ½äº§ç”Ÿçš„ï¼Œæˆ‘ä»¬å¯ä»¥è®©ä¸€ä¸ªçº¿ç¨‹åœ¨è®¿é—®å…±äº«æ•°æ®çš„æ—¶å€™ï¼Œæ— è®ºæ˜¯å¦å¤±å»äº†å¯¹CPUçš„æ‰§è¡Œæƒï¼Œè®©å…¶ä»–çš„çº¿ç¨‹åªèƒ½ç­‰å¾…å½“å‰å æœ‰CPUçš„çº¿ç¨‹æ‰§è¡Œå®Œå…¶æ‰€æœ‰çš„æ“ä½œï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½è·å–èµ„æºï¼ˆç­‰å¾…å½“å‰çº¿ç¨‹å–å®Œç¥¨ï¼Œå…¶ä»–çº¿ç¨‹åœ¨è¿›è¡Œå–ç¥¨ï¼‰

ä¿è¯ï¼šåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨å–ç¥¨ï¼Œå³åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨whileå¾ªç¯ä¸­è¿›è¡Œä¹°ç¥¨

**æ‰€ä»¥ï¼Œé’ˆå¯¹æ­¤é—®é¢˜ï¼ŒJavaä¸­æå‡ºäº†é”æœºåˆ¶**

é€šè¿‡`synchronized`å…³é”®å­—æ¥ç»™å¯¹è±¡ä¸Šé”

ğŸ‘‰[**çº¿ç¨‹çš„åŒæ­¥**](https://blog.csdn.net/weixin_43232955/article/details/97246026)ğŸ‘ˆ

---------------------

### å¤šçº¿ç¨‹æ¨¡æ‹Ÿå®ç°é¾Ÿå…”èµ›è·‘

> æ•…äº‹èƒŒæ™¯ï¼š
>
> ä»å‰æœ‰åº§å±±ï¼Œå±±ä¸Šæœ‰ä¸ªä¹Œé¾Ÿå’Œå…”å­ï¼Œç„¶åä»–ä»¬æ¯”èµ›ï¼Œç„¶åå…”å­ç¡ç€äº†ï¼Œç„¶åä¹Œé¾Ÿèµ¢äº†ï¼Œç„¶åå°±æ²¡æœ‰ç„¶åäº†....
> ![](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pcXFjb2RlLWJsb2cub3NzLWNuLWJlaWppbmcuYWxpeXVuY3MuY29tL2ltZy8yMDIwMDUyNjA5NDg1Ny5wbmc?x-oss-process=image/format,png)

```java
class Running implements Runnable {
    private  String winner;  //è·èƒœè€…åå­—
    @Override
    public void run() {
        for(int steps = 1;steps<=100;steps++) {
            //æ¨¡æ‹Ÿå…”å­ä¼‘æ¯,è®©å…”å­æ¯èµ°10æ­¥ç¡300ms
            if(Thread.currentThread().getName().equals("rabbit") && steps%10==0) {
                try {
                    Thread.sleep(300);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }
            }
            System.out.println(Thread.currentThread().getName() +"---->" + steps);
            //åˆ¤æ–­æ¯”èµ›æ˜¯å¦ç»“æŸ
            boolean flag = isOver(steps);
            if(flag)
                break;
        }
    }

    private boolean isOver(int steps) {
        if(winner != null)
            return true;
        else {
            if(steps == 100) {
                winner = Thread.currentThread().getName();
                System.out.println("\n***** Winner is " + winner + " *****");
                return true;
            }
        }
        return false;
    }
}


public class ThreadExample {
    public static void main(String[] args) {
        Running run = new Running();
        new Thread(run,"tortoise").start();
        new Thread(run,"rabbit").start();
    }
}
```

<img src="https://img-blog.csdnimg.cn/20190721214542288.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzIzMjk1NQ==,size_16,color_FFFFFF,t_70" width="70%">

 æœ€ç»ˆï¼Œå…”å­èµ°äº†10æ­¥ï¼Œä¹Œé¾Ÿèµ°äº†100æ­¥ï¼ŒWinnerä¸º ä¹Œé¾Ÿ

> è¿™ä¸ªæ•…äº‹å‘Šè¯‰æˆ‘ä»¬ï¼š
> 
> 1. è…¿é•¿çš„ä¸ä¸€å®šèµ°å¾—å¿«
> 2. æ—¶é—´å†çŸ­ä¹Ÿå¯ä»¥ç¡è§‰
> 3. åœ¨è¿™ä¸ªæ•…äº‹é‡Œï¼Œèµ¢å¾—æ€»ä¼šæ˜¯ä¹Œé¾Ÿï¼›å› ä¸ºç¼–æ•…äº‹çš„äººä¸æƒ³è®©å…”å­èµ¢ï¼Œä¸ç„¶è¿˜æ¯”ä»€ä¹ˆèµ›å‘€....å…”å­è¦æƒ³å˜çš„åƒåšå°”ç‰¹è¾£æ ·å¿«çš„è“äººï¼Œè¿˜å’Œä¹Œé¾Ÿæ¯”ä»€ä¹ˆï¼Œç›´æ¥å»æ‰¾çŒè±¹æ¯”äº†ï¼Œç ´é‡œæ²‰èˆŸ...
