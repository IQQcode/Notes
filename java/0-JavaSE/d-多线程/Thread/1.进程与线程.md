![](1.è¿›ç¨‹ä¸çº¿ç¨‹.assets/aHR0cHM6Ly9pcXFjb2RlLWJsb2cub3NzLWNuLWJlaWppbmcuYWxpeXVuY3MuY29tL2ltZy8yMDIwMDUyNjA5MzgwOC5wbmc)

## 1. è¿›ç¨‹ä¸çº¿ç¨‹

**è¿›ç¨‹ï¼š** è¿›å…¥åˆ°å†…å­˜ä¸­æ‰§è¡Œçš„ç¨‹åºç§°ä¸ºè¿›ç¨‹ï¼Œå®ƒæè¿°çš„æ˜¯æ“ä½œç³»ç»Ÿä¸­ä¸€ä¸ªç¨‹åºçš„æ‰§è¡Œå‘¨æœŸ

**çº¿ç¨‹ï¼š** ä¸€ä¸ªç¨‹åºåŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œä¸€ä¸ªä»»åŠ¡ç§°ä¹‹ä¸ºçº¿ç¨‹ï¼Œçº¿ç¨‹æ˜¯è¿›ç¨‹çš„æ‰§è¡Œå•å…ƒ

**è¿›ç¨‹äºçº¿ç¨‹çš„åŒºåˆ«**

1. æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸€æ•´å¥—å˜é‡ï¼Œè€Œçº¿ç¨‹åˆ™æ•°æ®å…±äº«

2. è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿä¸­èµ„æºåˆ†é…çš„æœ€å°å•ä½ï¼›çº¿ç¨‹æ˜¯OSä¸­ä»»åŠ¡è°ƒåº¦çš„åŸºæœ¬å•ä½

3. å¯åŠ¨ã€æ’¤é”€ä¸€ä¸ªè¿›ç¨‹çš„å¼€é”€è¦æ¯”çº¿ç¨‹å¤§å¾—å¤š

4. æ²¡æœ‰çº¿è¿›ç¨‹å°±æ²¡æœ‰çº¿ç¨‹ï¼Œè¿›ç¨‹ç»“æŸï¼Œçº¿ç¨‹ç»ˆæ­¢

**å¹¶å‘ä¸å¹¶è¡Œ**

ã€å¹¶å‘ç¼–ç¨‹çš„æœ¬è´¨ã€‘ï¼šå……åˆ†åˆ©ç”¨CPUèµ„æº

å¹¶å‘ï¼šæŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹ä»¶åœ¨==åŒä¸€æ—¶é—´æ®µ==å†…å‘ç”Ÿ

å¹¶è¡Œï¼šæŒ‡ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹ä»¶åœ¨==åŒä¸€æ—¶åˆ»==å‘ç”Ÿï¼ˆåŒæ—¶å‘ç”Ÿï¼‰

- å¹¶å‘ï¼šäº¤æ›¿æ‰§è¡Œï¼ˆä¸€ä¸ªCPUåœ¨æ¥å›åˆ‡æ¢ï¼‰
- å¹¶è¡Œï¼šåŒæ—¶æ‰§è¡Œï¼ˆå¤šä¸ªCPUåŒæ—¶å·¥ä½œï¼‰

![](1.è¿›ç¨‹ä¸çº¿ç¨‹.assets/aHR0cHM6Ly9pcXFjb2RlLWJsb2cub3NzLWNuLWJlaWppbmcuYWxpeXVuY3MuY29tL2ltZy8yMDIwMDUyNjA4MDY1MS5wbmc)
é«˜å¹¶å‘ï¼šè®¿é—®çº¿ç¨‹é‡éå¸¸éå¸¸é«˜(CPUå ç”¨ç‡é«˜99.9%)

> **JVMçš„å¯åŠ¨æ—¶æ˜¯å¤šçº¿ç¨‹çš„å—ï¼Ÿ**
> 
> - JVMçš„å¯åŠ¨è‡³å°‘å¯åŠ¨äº†åƒåœ¾å›æ”¶çº¿ç¨‹å’Œä¸»çº¿ç¨‹ï¼Œæ‰€ä»¥æ˜¯å¤šçº¿ç¨‹çš„

### çº¿ç¨‹çš„çŠ¶æ€ï¼ˆæ“ä½œç³»ç»Ÿå±‚é¢ï¼‰

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](1.è¿›ç¨‹ä¸çº¿ç¨‹.assets/20190721182015544.png)

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](1.è¿›ç¨‹ä¸çº¿ç¨‹.assets/20200528090659306.png)

> å›¾ä¸­ç¼ºå°‘äº†**WAITING**ã€‚å¤„äº`wait`ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹æƒ…å†µæ¯”è¾ƒç‰¹æ®Šï¼Œéœ€è¦é€šè¿‡`notify`æ¥å”¤é†’ã€‚ç”±äº`wait`ä¼šé‡Šæ”¾é”ï¼Œå”¤é†’ä¹‹åç½®äºåŒæ­¥é˜Ÿåˆ—ï¼Œåˆéœ€è¦é‡æ–°è·å–é”å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å†å›åˆ°é˜»å¡çŠ¶æ€ç­‰å¾…CPUè°ƒåº¦ã€‚

### çº¿ç¨‹çš„çŠ¶æ€ï¼ˆJava APIå±‚é¢ï¼‰

æ ¹æ®**Thread State**æšä¸¾ï¼Œåˆ†ä¸ºå…­ç§çŠ¶æ€

<img src="1.è¿›ç¨‹ä¸çº¿ç¨‹.assets/image-20200820122056117.png" alt="image-20200820122056117" style="zoom:60%;" />

| çŠ¶æ€         | æè¿°                                                         |
| ------------ | ------------------------------------------------------------ |
| NEW          | å°šæœªå¯åŠ¨çš„çº¿ç¨‹å¤„äºè¿™ç§çŠ¶æ€                                   |
| RUNNABLE     | åœ¨Javaè™šæ‹Ÿæœºä¸­çº¿ç¨‹å¤„äºå°±ç»ªï¼ˆreadyï¼‰å’Œè¿è¡Œä¸­ï¼ˆrunningï¼‰ä¸¤ç§çŠ¶æ€ç§°ä¸ºè¿è¡ŒçŠ¶æ€ |
| BLOCKED      | è¢«é˜»å¡ç­‰å¾…å¯¹è±¡é”çš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€                             |
| WAITING      | æ­£åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œç‰¹å®šåŠ¨ä½œçš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€               |
| TIME_WAITING | è¯¥çŠ¶æ€ä¸åŒäºWAITINGï¼Œå®ƒå¯ä»¥åœ¨æŒ‡å®šçš„æ—¶é—´åè‡ªè¡Œè¿”å›            |
| TERMINATED   | å·²ç»é€€å‡ºè¿è¡Œçš„çº¿ç¨‹å¤„äºæ­¤çŠ¶æ€                                 |

### runä¸startå¯åŠ¨çº¿ç¨‹

æ— è®ºä½¿ç”¨å“ªç§æ–¹å¼åˆ›å»ºçº¿ç¨‹ï¼Œå¯åŠ¨çº¿ç¨‹ä¸€å¾‹ä½¿ç”¨Threadç±»æä¾›çš„`strat()`ï¼Œ`run()`ä¸èƒ½ç”±ç”¨æˆ·ç›´æ¥è°ƒç”¨ï¼Œè€Œæ˜¯JVMè°ƒç”¨ã€‚

`run()`æ–¹æ³•åªèƒ½ç”±JVMè°ƒç”¨ï¼Œç”¨æˆ·è°ƒç”¨å’Œæ™®é€šæ–¹æ³•æ— åŒºåˆ«ï¼Œæ‰§è¡Œç»“æœæ˜¯å•çº¿ç¨‹çš„

`start() ` ---->  `start0()`  [æœ¬åœ°æ–¹æ³•]  ----->  è¿›å…¥åˆ°JVMä¸­è°ƒç”¨æ“ä½œç³»ç»Ÿå†™å¥½çš„æ–¹æ³•æ¥æ‰§è¡Œ

**JVMè°ƒç”¨`start0()`æ–¹æ³•è¿›è¡Œèµ„æºçš„åˆ†é…ä¸ç³»ç»Ÿè°ƒåº¦ï¼Œå‡†å¤‡å¥½èµ„æºå¯åŠ¨çº¿ç¨‹åå›è°ƒ`run()`æ–¹æ³•æ¥æ‰§è¡Œçº¿ç¨‹çš„å…·ä½“ä»»åŠ¡**

 ä¸€ä¸ªçº¿ç¨‹çš„`start`åªèƒ½è¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå¦åˆ™ä¼šæŠ›å‡º`IllegalThreadStartException`

> JavaçœŸçš„å¯ä»¥å¼€å¯çº¿ç¨‹å—ï¼Ÿ
>
> ç­”ï¼šJavaåœ¨åº•å±‚æ— æ³•çœŸæ­£å¼€å¯çº¿ç¨‹ï¼Œ`start0`æ˜¯æœ¬åœ°æ–¹æ³•ï¼ŒJavaæ— æ³•æ“ä½œç¡¬ä»¶ã€‚

-----

**run å­˜æ”¾çº¿ç¨‹çš„ä»»åŠ¡**
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](1.è¿›ç¨‹ä¸çº¿ç¨‹.assets/20190721182115913.png)

### çº¿ç¨‹åˆ›å»ºçš„åŸç†åˆ†æ

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](1.è¿›ç¨‹ä¸çº¿ç¨‹.assets/20200525180208135.png)
æ‰§è¡Œç»“æœï¼š

> run -> 0
> run -> 1
> run -> 2
> run -> 3
> main -->> 0
> main -->> 1
> main -->> 2
> main -->> 3
> main -->> 4
> main -->> 5
> main -->> 6
> main -->> 7
> main -->> 8
> run -> 4
> run -> 5
> run -> 6
> run -> 7
> main -->> 9
> run -> 8
> run -> 9

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](1.è¿›ç¨‹ä¸çº¿ç¨‹.assets/20200525175308472.png)
**çº¿ç¨‹çš„æ‰§è¡Œè°ƒåº¦**

çº¿ç¨‹è°ƒåº¦çš„é¡ºåºå–å†³äºCPUçš„è°ƒåº¦ï¼ŒCPUçš„è°ƒåº¦æ˜¯éšæœºçš„ã€‚è®¾ç½®çº¿ç¨‹è°ƒåº¦çš„ä¼˜å…ˆçº§åªæ˜¯æé«˜çº¿ç¨‹è¢«è°ƒåº¦çš„æ¦‚ç‡ï¼Œå¹¶ä¸ä¸€å®šæŒ‰ç…§ä¼˜å…ˆçº§è°ƒåº¦æ‰§è¡Œ

------------

## 2. Javaå®ç°å¤šçº¿ç¨‹

### a. ç»§æ‰¿Threadç±»

ã€å®ç°æ­¥éª¤ã€‘

1. åˆ›å»ºä¸€ä¸ªThreadç±»çš„å­ç±»
2. åœ¨ Threadç±»çš„å­ç±»ä¸­é‡å†™ Threadç±»ä¸­çš„runæ–¹æ³•ï¼Œè®¾ç½®çº¿ç¨‹ä»»åŠ¡ï¼ˆå¼€å¯çº¿ç¨‹è¦åšä»€ä¹ˆï¼Ÿï¼‰
3. åˆ›å»º Threaç±»çš„å­ç±»å¯¹è±¡
4. è°ƒç”¨ Threadç±»ä¸­çš„æ–¹æ³• `start`æ–¹æ³•ï¼Œå¼€å¯æ–°çš„çº¿ç¨‹ï¼ŒJVMæ‰§è¡Œ`run`æ–¹æ³•
- startæ–¹æ³•ä½¿è¯¥çº¿ç¨‹å¼€å§‹æ‰§è¡Œ
- JVMè°ƒç”¨è¯¥çº¿ç¨‹çš„runæ–¹æ³•æ¥æ‰§è¡Œçº¿ç¨‹ä»»åŠ¡

> åœ¨Javaä¸­æ˜¯å•ç»§æ‰¿åŸåˆ™ï¼Œå¦‚æœç»§æ‰¿äº†Threadç±»ï¼Œåé¢å°±æ— æ³•åœ¨è¿›è¡Œæ‹“å±•äº†

JDKæ–‡æ¡£è¯´æ˜ï¼š
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200525192355223.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzIzMjk1NQ==,size_16,color_FFFFFF,t_70)
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](1.è¿›ç¨‹ä¸çº¿ç¨‹.assets/20200525185730231.png)

### b. å®ç°Runnableæ¥å£

ã€å®ç°æ­¥éª¤ã€‘

1. åˆ›å»ºRunnableæ¥å£çš„å®ç°ç±»

2. åœ¨å®ç°ç±»ä¸­è¦†å†™Runnableæ¥å£çš„`run`æ–¹æ³•ï¼Œè®¾ç½®çº¿ç¨‹ä»»åŠ¡

3. å®ä¾‹åŒ–Runnableæ¥å£çš„å®ç°ç±»

4. åˆ›å»º Threadç±»å¯¹è±¡ï¼Œæ„é€ æ–¹æ³•ä¸­ä¼ é€’ Runnableæ¥å£çš„å®ç°ç±»å¯¹è±¡

5. è°ƒç”¨ Threaç±»ä¸­çš„`start`æ–¹æ³•ï¼Œå¼€å¯æ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œ`run`æ–¹æ³•
   
   JDKæ–‡æ¡£è¯´æ˜ï¼š
   ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20200525192316343.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzIzMjk1NQ==,size_16,color_FFFFFF,t_70)
   åœ¨Threadç±»ä¸­ï¼Œä»–çš„æ„é€ æ–¹æ³•å¯ä»¥æ¥æ”¶Runnableæ¥å£
   ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](1.è¿›ç¨‹ä¸çº¿ç¨‹.assets/202005251919251.png)
   ![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](1.è¿›ç¨‹ä¸çº¿ç¨‹.assets/20200526092132624.png)

### c. Callableå®ç°å¤šçº¿ç¨‹

Callableæ¥å£ç±»ä¼¼äºRunnableï¼Œå› ä¸ºå®ƒä»¬éƒ½æ˜¯ä¸ºå…¶å®ä¾‹å¯èƒ½ç”±å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œçš„ç±»è®¾è®¡çš„ã€‚ ç„¶è€Œï¼Œ `Runnable`ä¸è¿”å›ç»“æœï¼Œä¹Ÿä¸èƒ½æŠ›å‡ºè¢«æ£€æŸ¥çš„å¼‚å¸¸ã€‚

è¯¥Executorsç±»åŒ…å«çš„å®ç”¨æ–¹æ³•ï¼Œä»å…¶ä»–æ™®é€šå½¢å¼è½¬æ¢ä¸ºCallableç±»ã€‚

ã€å®ç°æ­¥éª¤ã€‘

```java
1. å®ç°Callableæ¥å£ï¼Œéœ€è¦è¿”å›å€¼ç±»å‹

2. é‡å†™call()æ–¹æ³•ï¼ŒæŠ›å‡ºå¼‚å¸¸

3. åˆ›å»ºç›®æ ‡å¯¹è±¡ MyCallable mc = new MyCallable();

4. åˆ›å»ºæœåŠ¡ ExecutorService service = Executors.newFixedThreadPool(3);

5. æäº¤æ‰§è¡ŒæœåŠ¡   Future<String> thread = service.submit(mc); 

6. è·å–è¿”å›å€¼ thread.get();

7. å…³é—­æœåŠ¡  service.shutdown();
```

> - çµæ´»æ‹“å±•ï¼Œæ³›å‹ç±»ä¸ºä»»æ„è¿”å›å€¼ç±»å‹
> - å¯ä»¥å°†å¼‚å¸¸æŠ›å‡º

é‡å†™`call()`æ–¹æ³•ï¼Œç­‰åŒäº`run`æ–¹æ³•ï¼Œå­˜æ”¾çº¿ç¨‹è¦æ‰§è¡Œçš„ä»»åŠ¡

![](1.è¿›ç¨‹ä¸çº¿ç¨‹.assets/aHR0cHM6Ly9pcXFjb2RlLWJsb2cub3NzLWNuLWJlaWppbmcuYWxpeXVuY3MuY29tL2ltZy8yMDIwMDUyNjEzNDcxMi5wbmc)

**Callableå¯¹æ¯”äºRunnable**

1. éœ€è¦å®ç°çš„æ–¹æ³•ä¸åŒ`call`

2. æœ‰è¿”å›å€¼

3. å¯ä»¥æŠ›å‡ºå¼‚å¸¸

### d. çº¿ç¨‹æ±  -- æ¨è

[**ğŸ‘‰çº¿ç¨‹æ± ğŸ‘ˆ**](https://blog.csdn.net/weixin_43232955/article/details/98971298)

```java
class  MyThread implements Callable<String> {
    private Integer tickets = 20;

    @Override
    //çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡ call()
    public String call() throws  Exception {
        while(this.tickets > 0) {
            System.out.println(Thread.currentThread().getName() + " å‰©ä½™ç¥¨æ•°ä¸º" + (this.tickets--));
        }
        return Thread.currentThread().getName() + " ç¥¨å–å®Œäº†â€¦â€¦";
    }
}

public class AchieveThread {
    public static void main(String[] args) throws Exception {
        // Future: æ¥æ”¶Callableæ¥å£çš„è¿”å›å€¼
        // FutureTask åœ¨å¤šçº¿ç¨‹å¹¶å‘ä¸‹å¯ä»¥ä¿è¯ä»»åŠ¡(ä¼ å…¥çš„Callableæˆ–Runnable)åªæ‰§è¡Œä¸€æ¬¡

        //ç¼“å­˜çº¿ç¨‹æ± åˆ›å»ºçº¿ç¨‹
        ExecutorService exec = Executors.newCachedThreadPool();
        Callable<String> callable = new MyThread();
        for(int i = 0;i < 3; i++) {
            exec.submit(callable);
        }
        exec.shutdown();
    }
}
```

-----------------

## 3. åŒ¿åå†…éƒ¨ç±»åˆ›å»ºçº¿ç¨‹

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](1.è¿›ç¨‹ä¸çº¿ç¨‹.assets/20200525222637934.png)

### Runnableå¯¹è±¡å®ä¾‹åŒ–

**I.Threadç±»æä¾›çš„æ„é€ æ–¹æ³•æ¥æ¥æ”¶Runnableå¯¹è±¡**

```java
MyRunnable run = new MyRunnable();
new Thread(run).start();
```

**II. åŒ¿åå†…éƒ¨ç±»ï¼š**

```java
new Thread(new Runnable() {
    @Override
    public void run() {
        //çº¿ç¨‹ä»»åŠ¡
    }
}).start();
```

**III. Lambdaè¡¨è¾¾å¼ï¼š**

```java
Runnable runnable = () -> System.out.println("Lambdaè¡¨è¾¾å¼");
new Thread(runnable).start();
```

## 4. ç»§æ‰¿Threadç±»ä¸å®ç°Runnableçš„åŒºåˆ«

<font color=#6495ED size=4>**å®ç°Runnableæ¥å›—åˆ›å»ºå¤šçº¿ç¨‹ç¨‹åºçš„å¥½å¤„**</font>

**I. é¿å…äº†å•ç»§æ‰¿çš„å±€é™æ€§**

ä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªç±»ï¼ˆä¸€ä¸ªäººåªèƒ½æœ‰ä¸€ä¸ªäº²çˆ¹ï¼‰ï¼Œç±»ç»§æ‰¿äº† Threadç±»å°±ä¸èƒ½ç»§æ‰¿å…¶ä»–çš„ç±»ã€‚
å®ç°äº† Runnableæ¥å£ï¼Œå¯ä»¥ç»§æ‰¿å…¶ä»–çš„ç±»ï¼Œå®ç°å…¶ä»–çš„æ¥å£ã€‚

**2. å¢å¼ºäº†ç¨‹åºçš„æ‰©å±•æ€§ï¼Œé™ä½äº†ç¨‹åºçš„è€¦åˆæ€§ï¼ˆè§£è€¦ï¼‰**

å®ç° Runnableæ¥å£çš„æ–¹å¼æŠŠè®¾ç½®çº¿ç¨‹ä»»åŠ¡å’Œå¼€å¯æ–°çº¿ç¨‹è¿›è¡Œäº†åˆ†ç¦»ï¼ˆè§£è€¦ï¼‰

- å®ç°ç±»ä¸­ï¼Œé‡å†™äº†`run`æ–¹æ³•æ¥è®¾ç½®çº¿ç¨‹ä»»åŠ¡
- åˆ›å»º Threadç±»å¯¹è±¡ï¼Œè°ƒç”¨`start`æ–¹æ³•æ¥å¼€å¯æ–°çº¿ç¨‹

--------------------------

<font  size=4>**[èµ„æºå…±äº«å¸¦æ¥çš„å¹¶å‘é—®é¢˜](https://blog.csdn.net/weixin_43232955/article/details/96761123)**</font>

**ä¹°ç¥¨é—®é¢˜ï¼šä¸€ä»½èµ„æºï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«ï¼Œä¼šå¸¦æ¥å¹¶å‘é—®é¢˜(æ•°æ®çš„ä¸ä¸€è‡´æ€§)**

```java
class Web123 implements Runnable {
    private Integer tickets = 50;
    @Override
    public void run() {
        while (tickets >= 0) {
            try {
                Thread.sleep(200);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            System.out.println(Thread.currentThread().getName() + "---->" + tickets--);
        }
    }
}

public class TicketsConcurrency {
    public static void main(String[] args) {
        Web123 web123 = new Web123();    //ä¸€åˆ†èµ„æºï¼Œå¤šä¸ªå…±äº«
        System.out.println(Thread.currentThread().getName());
        new Thread(web123,"é»„ç‰›A").start();
        new Thread(web123,"é»„ç‰›B").start();
        new Thread(web123,"é»„ç‰›C").start();
    }
}
```

<img src="https://img-blog.csdnimg.cn/20190721182151484.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzIzMjk1NQ==,size_16,color_FFFFFF,t_70" width="60%">