## 1. GC分类与性能指标

> 垃圾收集器没有在JVM规范中进行过多的规定，可以由不同的厂商来实现
> 
> - Oracle：CMS、G1
> 
> - IBM：
> 
> - ReadHeat：Shenandoah GC

**评估GC性能的重要指标：**

- 吞吐量：运行用户代码的时间占总运行时间的比例

- 暂停时间[STW]：执行垃圾收集时，程序的工作线程被暂停的时间

- 内存占用：Java堆区所占的内存大小

**吞吐量**

吞吐量就是CPU运行用户代码的时间与CPU总消耗时间的比值，即：

- 吞吐量 = 运行用户代码时间 /（运行用户代码时间 + 垃圾收集时间）

- 吞吐量高是降低了内存回收的执行频率

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/imgs01/20200804192638.png)

比如：虚拟机总共运行了100分钟，其中垃圾收集花掉1分钟，那吞量就是99%

**暂停时间**

暂停时间是指一个<u>时间段内</u>应用程序线程暂停，让GC线程执行的状态，例如：

- GC期间100毫秒的暂停时间，意味着在这100毫秒期间内没有<u>应用程序线程</u>是活动的

- 暂停时间短，但是频繁的执行内存回收

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/imgs01/20200804192657.png)

这两个指标本质上是互斥的，我们只能在**最大吞吐量优先**的情况下，降低停顿时间。

-----------------------

## 2. 垃圾回收器的介绍

**垃圾回收器与JVM是紧密相连的，不同厂商的JVM有着不同的垃圾回收器，不同的垃圾回收器有不同的GC。具体到什么场景下的使用**

- 用户交互：注重低延迟

- 服务器：注重高吞吐量

**高吞吐量:**

高效率地利用CPU时间，尽快完成程序的运算任务，主要适合在后台运算而不需要太多交互的任务。因此，常见在<mark>服务器环境</mark>中使用。例如：

- 执行批量处理

- 订单处理

- 工资支付

- 科学计算的应用程序

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/imgs01/20200804201806.png)

7款经典收集翳与垃圾分代之间的关系：

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/imgs01/20200804202525.png)

垃圾收集器的组合关系：

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/imgs01/20200804202830.png)

**如何查看默认的垃圾收集器：**

- `-XX：+PrintCommandLineflags`：查看命令行相关参数（包含使用的垃圾收集器）

- 使用命令行指令：`jinfo-flag`相关垃圾回收器参数进程ID

--------------------

## 3. G1

-----------------------

## 4. CMS

------------------------

## 5. Serial

Serial收集器是最基本、历史最悠久的垃圾收集器了。JDK1.3之前回收新生代唯一的选择。

Serial收集器采用**复制算法、串行回收和`Stop The World`机制**的方式执行内存回收。

除了年轻代之外， Serial收集器还提供用于执行老年代垃圾收集的**Serial Old**收集器。

Serial Old收集器同样也采用了串行回收和`Stop The World`机制，只不过内存回收算法使用的是**标记-压缩算法**

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/imgs01/20200804223007.png)

这个收集器是一个单线程的收集器，但它的“单线程”的意义并不仅仅说明它只会使用一个CPU或一条收集线程去完成垃圾收集工作，更重要的是在它进行垃圾收集时，必须**暂停**其他所有的工作线程，直到它收集结束（ Stop the World）

**【参数设置】**

- `-XX:+UseSerialGC`：表明新生代使用 Serial GC，同时老年代使用 SerialOld GC

应用场景：

- 单核CPU使用

-----------------

## 6. ParNew

**ParNew是Serial的多线程版本**

New：只能处理的是新生代

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/imgs01/20200805103836.png)

ParDew收集器采用**并行回收**的方式执行内存回收外，其余与Serial之间几乎没有任何区别。 

ParDew收集器在年轻代中同样也是采用复制算法、"Stop-The-World"机制

**【参数设置】**

- `-XX:+UseSerialGC`：表明新生代使用 Serial GC，同时老年代使用 SerialOld GC

- `-XX:+UseParNewGC`：表明新生代使用 ParDew GC

【小结】

- 单CPU：使用Serial回收器

- 多CPU或多核心：使用ParNew，提高吞吐量



---------------

## 7. Parallel

Parallel Scavenge收集器同样也采用了**复制算法、并行回收**和"Stop The World"机制。

和ParDew收集器不同，Paralllel Scavenge收集器的目标则是达到一个<font color = red>**可控制的吞吐量（Throughput）**</font>，它也被称为吞吐量优先的垃圾收集器

**自适应调节策略**也是 Parallel Scavenge与 ParNew一个重要区别

自适应模式下，年轻代的大小、Eden和 Survivor的比例、晋升老年代的对象年龄等参数会被自动调整，已达到在堆大小、吞吐量和停顿时间之间的平衡点

**【参数配置】**

- `-XX:+UseParallelGC`手行内存回收任务

- `-XX:+UseParallelOldGC`（JDK8默认开启）

> 这两个参数互相激活，一个使用则另一个也被使用
> 
> 



![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/imgs01/20200805151341.png)

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/imgs01/20200805151222.png)
