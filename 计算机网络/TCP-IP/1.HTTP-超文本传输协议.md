## HTTP简介

**HTTP-超文本传输协议**，通过Web服务器来传输 超文本信息HTML，它是一个**应用层协议**

### HTTP协议特点

**1. 客户端 / 服务器模式**

- 客户端发出请求，服务器来响应请求

**2. 无状态**

- 每次连接只处理一个请求，每个请求都是独立的。服务器处理完客户端的请求后并收到应答后，就断开连接

### URI & URL

<img src="1.HTTP-超文本传输协议.assets/image-20200906104804312.png" alt="image-20200906104804312" style="zoom:33%;" />

![image-20200906104937781](1.HTTP-超文本传输协议.assets/image-20200906104937781.png)

- **URI** ： 统一资源**标识符**，对Web上资源的标识
- **URL** ：统一资源**定位符**，<u>资源的请求地址</u> 【地址】
- **URN** ：统一资源**名称**，唯一的标识信息 【姓名】

------------------

## 请求报文

**请求消息数据格式**

- 请求行

- 请求头

- 请求空行

- 请求体

![请求](1.HTTP-超文本传输协议.assets/请求.png)

```http
GET /article/12 HTTP/1.1
Host: www.xxx.cn
Connection: keep-alive
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/80.0.3987.106 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Cookie: SESSION=so9nlsvenminor5abs65sh9dsa
```



### HTTP请求方法

![请求方法](1.HTTP-超文本传输协议.assets/请求方法.png)



**1. GET**：HTTP默认请求方式，请求已被URI识别的资源

**2. POST**：提交表单数据，大小无限制。

**3. PUT**：传送资源（创建用POST，更新用PUT）

**4. HEAD**：只请求报文头，用于测试网络连接

**5. DELETE**：删除资源

<br>

## 响应报文

- 响应行
- 响应体
- 响应空行
- 响应体

![响应报文](1.HTTP-超文本传输协议.assets/响应报文.png)

```http
HTTP/1.1 200 OK
Server: nginx
Date: Sun, 17 May 2020 17:04:29 GMT
Content-Type: text/html; charset=UTF-8
Transfer-Encoding: chunked
Connection: keep-alive
Vary: Accept-Encoding
X-Powered-By: blade-2.0.6-BETA
Content-Encoding: gzip
```



### HTTP响应状态码

**HTTP状态码共分为5种类型**

| 分类 |                    分类描述                    |
| :--: | :--------------------------------------------: |
| 1xx  |                 服务器转换协议                 |
| 2xx  |                    请求成功                    |
| 3xx  |                     重定向                     |
| 4xx  |       客户端错误，请求路径没有对应的资源       |
| 5xx  | 服务器错误，服务器在处理请求的过程中发生了错误 |

**1xx代表：**

- 101：协议升级，如HTTP协议升级到WebSocket协议

**2xx代表：**

- 200正常处理，请求成功

**3xx代表：**

- 301：永久重定向。本地请求的资源以及不存在，使用新的URI再次访问
- 302：临时重定向。所请求的资源暂时还在，但是目前需要用另一个URI访问

>301 和 302 通过在字段Location中表明需要跳转的URI。两者最大的不同在于一个是临时改变，一个是永久改变。举个例子，有时候需要将网站全部升级为HTTPS，这种永久性改变就需要配置永久的"301"。有时候晚上更新系统，系统暂时不可用，可以配置"302"临时访问，此时不会做缓存优化，第二天还会访问原来的地址。

**4xx代表：**

- 403：请求页面的访问被禁止
- 404（请求路径没有对应的资源）
- 405：请求方式没有对应的`doXxx`方法
- 408：请求超时，服务器等待了过长的时间
- 409：多个请求发生了冲突，可以理解为多线程并发时的竞态

**5xx代表：**

- 500：服务器内部错误，服务器在处理请求的过程中发生了错误
- 502： 请求未完成，无效的响应
- 503：由于超载或系统维护，服务器暂时的无法处理客户端的请求

<br>

## 会话机制 [状态管理]

###  Cookie

**Cookie是服务器给客户端颁发的一个`通行证`，用来标识客户端的状态。**

Cookie是一小段的文本信息，当浏览器向服务器请求数据时，会携带自己的Cookie一同提交给服务器。服务器检查该Cookie，辨别用户状态。

![image-20200907092325205](1.HTTP-超文本传输协议.assets/image-20200907092325205.png)



![image-20200907092702563](1.HTTP-超文本传输协议.assets/image-20200907092702563.png)

- 首次连接，服务器会通过`set-cookie`为客户端颁发

- Cookie可以被服务器修改
- Cookie失效时间较长，可以设为永久有效

### Session

**Session是服务端来记录客户端状态的机制，保存在服务器上**

![image-20200907093302734](1.HTTP-超文本传输协议.assets/image-20200907093302734.png)

客户端访问服务器时，服务端把该客户端`SessionID`（唯一的）记录在服务器上

- 第一次访问，新创建`SessionID`

- 再次访问只需检查该客户端对相应的`SessionID`即可

**如果Cookie禁用，则采用URL重写**

- 【方式一】将SessionID附加到URL后缀
- 【方式二】以查询`SessionID`的字符串形式附加到URL中
- 【方式三】将SessionID隐藏在表单中提交

**为了防止服务器内存溢出，Session会超时失效**

- 长时间不使用该Session，会超时失效
- 程序调用`HttpSession.invaliddate()`，Session自动失效



### 二者对比

存放位置不同

安全性（隐私策略）不同

- Cookie是客户端的信息，存在敏感信息泄露的风险，需加密（用户名密码等不要放入Cookie，或者要加密）
- Session对客户端是透明的

失效时间不同

<br>

## HTTP身份验证

![image-20200907094748340](1.HTTP-超文本传输协议.assets/image-20200907094748340.png)

### SSL认证

SSL客户端认证是借助`HTTPS`的客户端证书完成认证的方式。凭借客户端证书认证，服务器可以确认访问是否来自自己认证过的客户端。

导入证书和维护认证的方式相对繁琐，多数网站采用**基于表单的认证**

### 表单认证

通过Cookie和Session会话方式来认证

