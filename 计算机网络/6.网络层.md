## 1. 网络层概述

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200720104109.png)

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200721143412.png)

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200720104328.png)

> 包是全能性的术语。在数据附加的首部均可以称为包。

【网络层的作用】：把分组从源端传到目的端，为 分组交换网上的不同主机 提供**通信服务**。

**网络层传输单位是分组**。分组是数据报的子集，网络层的数据交换方式为数据报。

数据报与分组是包含关系，数据报是较长的数据，而分组是将其切割成的一个个片段。

- 如果封装好的IP数据报较短时，可以直接传输，即此时一个数据报就是一个分组
- 如果封装好的IP数据报较长时，需要切割为多个分组来传输

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200720103603.png)

**【传输单元名词解析】**

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200720115308.png)

## 2. 网络层功能

1. 路由选择与分组转发（最佳路径）
2. 异构网络互连
3. 拥塞控制

【拥塞控制】：若所有结点都来不及接受分组，而要丢弃大量分组的话，网络就处于拥塞状态。因此要采取一定措施，缓解这种拥塞

区别于TCP的流量控制，网络层的拥塞控制是整个网络负载过重，每个节点都在非常忙碌的工作，导致分组的转发速率很慢。所以通过拥塞控制来缓解这种拥塞。

解决的方式有：

- 开环控制（静态）
- 闭环控制（动态）

### 数据交换方式

**【数据交换方式】**

1. 电路交换（有连接）
2. 报文交换（无连接）
3. 分组交换
	- 数据报交换（无连接）
	- 虚电路交换（逻辑连接）

<hr>

## 3.  网络层的数据交换方式—IP数据报

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200720121627.png)

|        特点        |              数据报服务              |
| :----------------: | :----------------------------------: |
|     建立的连接     |                无连接                |
|        地址        |          有目标地址和源地址          |
|      路由选择      |   每个分组独立进行路由的选择与转发   |
|      分组顺序      |          不保证分组的有序性          |
|       可靠性       |                不可靠                |
| 对网络故障的适应性 | 出故障的节点丢失分组，但仍能正常传输 |
| 差错处理和流量控制 |         用户主机进行流量控制         |

### IP数据报格式

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200721143649.png)

IP数据报格式由两部分构成

1. 首部
2. 数据部分（传输层数据单元）

在数据发送往下一层（数据链路层）时，IP数据报<font color = red>先从首部开始</font>，然后向后逐比特流发送。

【首部】：**固定部分**必须要有，大小为20bytes；可变部分可有可无

【数据部分】：传输层的数据单元

首部共20`Byte`，160`bit`。其中，每一部分的长度都是按照4`bit`的方式对齐，及都是4的整数倍。

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200721150943.png)

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200721185822.png)

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200721145704.png)

【版本version】：采用IPv4或者IPv6

----------------------

【首部】：首部长度 = 固定部分 + 可变部分，单位为`4Byte`。即首部长度在`5 * 4byte`  ~  `8 * 4byte`

（20Byte~32Byte）之间。代表的二进制位从`0101`到`1000`

------------------

【区分服务】：强调数据报的优先级

------------------

【总长度】：首部长度 + 数据长度，单位为`byte`  。IP数据报长度的上限值为2^16^ = 65535`B`

但是实际的长度是不会达到上限值的，因为长度过大我们就会分片，满足数据链路层的MTU（最大数据传输单元）的要求，采用**分组发送**

-------------------------

【标识】：同一数据报的分片使用同一标识

【标志】：只有2位有意义x _  _

中间位DF（**Don' t Fragment**）：

- DF=1，禁止分片

- DF=0，允许分片

最低位MF（ More Fragment）：

- MF=1，后面“还有分片”

- MF=0，代表最后一片/没分片

【片偏移】：指出较长分组分片后，某片在原分组中的相对位置。以8B为单位

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200721164541.png)

-------------------------

【生存时间TTL】：IP分组的保质期，每经过一个路由器`-1`，变成0则丢弃

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200721160002.png)

设置生存时间的原因：防止无法交付的数据无限制的在网络中传输，消耗网络资源 

--------------------------

【协议】：传输层的数据使用的协议，重点关注的是TCP`6`、UDP`17`

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200721160148.png)

> TCP是面向连接的传输，传输数据安全有保障，很6️⃣
>
> UDP是不面向连接，链路不太可靠，可能会造成丢包现象，数据很容易被“遗弃”，故为1️⃣7️⃣

-------------------

【首部检验和】：检验首部信息，检验的方式为求和。

在数据传输过程中，数据报每进过一个路由器，路由器都要重新计算首部检验和，如生存时间、标志、片偏移这些字段都可能发生变化。所要检验数据报变化之后是否正确，如检验不通过则丢弃次数据报，否则继续传输

-----------------

【源地址】、【目的地址】：32位，即2^32^ - 1

【可选字段】：0~40B，用来支持排错、测量以及安全等措施

【填充】：全0，把首部补成4B的整数倍（4字节的对齐方式）

<hr>

### IP数据报分片

**最大传送单元MTU**

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200721162634.png)



<hr>

## 4. IPv4

**IP地址**（英语：IP Address, 全称：Internet Protocol Address），又译为**网际协议地址、互联网协议地址**。当设备连接网络，设备将被分配一个IP地址，用作标识。通过IP地址，设备间可以互相通讯，如果没有IP地址，我们将无法知道哪个设备是发送方，无法知道哪个是接收方。

常见的IP地址分为 [IPv4](https://zh.wikipedia.org/wiki/IPv4) 与 [IPv6](https://zh.wikipedia.org/wiki/IPv6) 两大类，IP地址由一串数字组成。

[IPv4](https://zh.wikipedia.org/wiki/IPv4) <font color=#E86060>32位/4字节</font>标识符，由点分十进制数字组成，并以点分隔，如：`172.16.254.1` ；地址空间中只有2^32^个地址（约42.9亿）

[IPv6](https://zh.wikipedia.org/wiki/IPv6) 由十六进制数字组成，以冒号分割，如：`2001:db8:0:1234:0:567:8:1`

IP地址有两个主要功能：

- **标识主机** 
- **[网络寻址](https://zh.wikipedia.org/wiki/網路位址)**



### IP地址的分类

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200721173018.png)

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200721173244.png)

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200721182954.png)

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200721173225.png)

- **全0为本网络**
- **全1为广播分组**

这些都是特殊IP，是不能被指派的，因此网络号NetID和主机号HostID不能全0或全1

### 子网掩码计算

已知IP地址和子网掩码，计算网络地址。二者按位`&`即可

![](https://iqqcode-blog.oss-cn-beijing.aliyuncs.com/img/20200721183116.png)

141     14     72      24

255   255   192        0  `&`

141     14     64        0







---------------

[漫画：全球 IPv4 地址正式耗尽？到底什么是 IPv4 和 IPv6 ？](https://blog.csdn.net/csdnsevenn/article/details/103379355?ops_request_misc=%7B%22request%5Fid%22%3A%22159532893719724848304123%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&request_id=159532893719724848304123&biz_id=0&spm=1018.2118.3001.4187)

